<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <title>ğŸ• Reina Robot Kodlama Oyunu</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/blockly@10.0.0/blockly.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      font-family: "Comic Neue", cursive, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #4a5568;
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
      text-align: center;
      color: #718096;
      font-size: 1.2em;
      margin-bottom: 30px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      border: none;
      color: white;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 50px;
      cursor: pointer;
      font-family: "Comic Neue", cursive, sans-serif;
      font-weight: bold;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
      background: linear-gradient(45deg, #ee5a24, #ff6b6b);
    }

    button:active {
      transform: translateY(-1px);
    }

    .reset-btn {
      background: linear-gradient(45deg, #74b9ff, #0984e3);
    }

    .reset-btn:hover {
      background: linear-gradient(45deg, #0984e3, #74b9ff);
    }

    #blocklyDiv {
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin: 20px 0;
      background-color: #f8f9fa;
      border: 3px solid #e9ecef;
    }

    /* Blockly baÄŸlantÄ± noktalarÄ±nÄ± kÃ¶ÅŸeli yapma */
    .blocklyPath {
      stroke-linejoin: miter !important;
      stroke-linecap: square !important;
    }

    /* Blok kÃ¶ÅŸelerini keskinleÅŸtirme */
    .blocklyBlockBackground {
      rx: 2 !important;
      ry: 2 !important;
    }

    /* BaÄŸlantÄ± noktalarÄ±nÄ± kÃ¶ÅŸeli yapma */
    .blocklyConnectionLine {
      stroke-linecap: square !important;
      stroke-linejoin: miter !important;
    }

    /* Tab ve slot baÄŸlantÄ±larÄ±nÄ± kÃ¶ÅŸeli yapma */
    .blocklyHighlightedConnectionPath {
      stroke-linecap: square !important;
      stroke-linejoin: miter !important;
    }

    /* Blok gÃ¶lgelerini keskinleÅŸtirme */
    .blocklyShadow {
      filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3)) !important;
    }

    /* Puzzle tab ÅŸekillerini kÃ¶ÅŸeli yapma */
    .blocklyPath[d*="c"] {
      stroke-linejoin: miter !important;
    }

    /* Blok iÃ§indeki metinleri ve simgeleri bÃ¼yÃ¼tme - KÃœÃ‡ÃœLTÃœLMÃœÅ YAZIM FONTLARI */
    .blocklyText {
      font-size: 14px !important;
      font-weight: bold !important;
      font-family: "Comic Neue", cursive, sans-serif !important;
    }

    /* Blok field'larÄ±nÄ± kÃ¼Ã§Ã¼ltme */
    .blocklyFieldLabel {
      font-size: 14px !important;
      font-weight: bold !important;
      font-family: "Comic Neue", cursive, sans-serif !important;
    }

    /* Dropdown ve input field'larÄ±nÄ± kÃ¼Ã§Ã¼ltme */
    .blocklyFieldTextInput,
    .blocklyFieldNumber,
    .blocklyFieldDropdown {
      font-size: 13px !important;
      font-weight: bold !important;
      font-family: "Comic Neue", cursive, sans-serif !important;
      padding: 6px 10px !important;
      border-radius: 6px !important;
    }

    /* Toolbox kategorilerini kÃ¼Ã§Ã¼ltme */
    .blocklyTreeLabel {
      font-size: 16px !important;
      font-weight: bold !important;
      font-family: "Comic Neue", cursive, sans-serif !important;
    }

    /* Blok iÃ§indeki emoji ve simgeleri 30px yapma - EMOJÄ°LER BÃœYÃœK KALIYOR */
    .blocklyText tspan {
      font-size: 30px !important;
    }

    /* Ã–zel emoji bÃ¼yÃ¼tme - 30px - EMOJÄ°LER BÃœYÃœK */
    .blocklyText:contains("ğŸ•"),
    .blocklyText:contains("ğŸ”™"),
    .blocklyText:contains("â†©ï¸"),
    .blocklyText:contains("â†ªï¸"),
    .blocklyText:contains("ğŸª‘"),
    .blocklyText:contains("ğŸ§"),
    .blocklyText:contains("ğŸ˜´"),
    .blocklyText:contains("â˜€ï¸"),
    .blocklyText:contains("ğŸ”Š"),
    .blocklyText:contains("ğŸ˜¢"),
    .blocklyText:contains("ğŸŒ™"),
    .blocklyText:contains("ğŸµ"),
    .blocklyText:contains("ğŸ˜Š"),
    .blocklyText:contains("ğŸ¤©"),
    .blocklyText:contains("ğŸ˜ "),
    .blocklyText:contains("ğŸ¾"),
    .blocklyText:contains("ğŸ”„"),
    .blocklyText:contains("ğŸ¤"),
    .blocklyText:contains("ğŸ’ƒ"),
    .blocklyText:contains("ğŸŒ€"),
    .blocklyText:contains("â°"),
    .blocklyText:contains("ğŸ”"),
    .blocklyText:contains("ğŸ¤”"),
    .blocklyText:contains("ğŸ”—") {
      font-size: 30px !important;
    }

    /* Blok boyutlarÄ±nÄ± daha fazla artÄ±rma - emojilere uygun */
    .blocklyBlockBackground {
      transform: scale(1.3) !important;
      transform-origin: center !important;
    }

    /* Bloklar arasÄ± boÅŸluÄŸu daha fazla artÄ±rma */
    .blocklyWorkspace {
      padding: 30px !important;
    }

    /* Toolbox geniÅŸliÄŸini artÄ±rma - bÃ¼yÃ¼k bloklar iÃ§in */
    .blocklyToolboxDiv {
      min-width: 280px !important;
    }

    /* Blok iÃ§indeki padding'i artÄ±rma */
    .blocklyBlockBackground {
      padding: 8px !important;
    }

    /* Kategori baÅŸlÄ±klarÄ±nÄ± kÃ¼Ã§Ã¼ltme */
    .blocklyTreeRow {
      min-height: 40px !important;
      line-height: 40px !important;
    }

    /* Blok baÄŸlantÄ± noktalarÄ±nÄ± bÃ¼yÃ¼tme */
    .blocklyPath {
      stroke-width: 3px !important;
    }

    /* Workspace zoom ayarlarÄ± - bÃ¼yÃ¼k bloklar iÃ§in */
    .blocklyZoom {
      transform: scale(0.8) !important;
    }

    .robot-display {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      color: white;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .robot-ascii {
      font-family: monospace;
      font-size: 14px;
      line-height: 1.2;
      white-space: pre;
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .status {
      font-size: 1.5em;
      font-weight: bold;
      margin: 10px 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .output {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      min-height: 100px;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    @keyframes wag {

      0%,
      100% {
        transform: rotate(-10deg);
      }

      50% {
        transform: rotate(10deg);
      }
    }

    .wagging {
      animation: wag 0.3s ease-in-out infinite;
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .bouncing {
      animation: bounce 0.5s ease-in-out infinite;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    .shaking {
      animation: shake 0.5s ease-in-out 3;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ• KÃ¶pek Robot Kodlama Oyunu ğŸ¤–</h1>
    <p class="subtitle">Sevimli kÃ¶pek robotunu bloklar ile kodla ve hareketlerini kontrol et!</p>

    <div class="controls">
      <button onclick="runCode()">ğŸš€ Kodu Ã‡alÄ±ÅŸtÄ±r!</button>
      <button class="reset-btn" onclick="resetRobot()">ğŸ”„ Robotu SÄ±fÄ±rla</button>
    </div>

    <div id="blocklyDiv" style="height: 600px; width: 100%;"></div>

    <div class="robot-display">
      <div class="status" id="robotStatus">ğŸ• Robot HazÄ±r!</div>
      <div class="robot-ascii" id="robotDisplay"></div>
    </div>

    <div class="output" id="output">
      <strong>ğŸ® Robot Konsolu:</strong><br>
      Merhaba! Ben senin kÃ¶pek robotunum. Beni kodla ve benimle oyna! ğŸ¾
    </div>
  </div>

  <xml id="toolbox" style="display: none">
    <category name="ğŸ• Robot Hareketleri" colour="#FF6B6B">
      <block type="move_forward"></block>
      <block type="move_backward"></block>
      <block type="turn_left"></block>
      <block type="turn_right"></block>
      <block type="sit"></block>
      <block type="stand"></block>
      <block type="lie_down"></block>
      <block type="wake_up"></block>
    </category>

    <category name="ğŸ”Š Sesler" colour="#74B9FF">
      <block type="bark"></block>
      <block type="whine"></block>
      <block type="howl"></block>
      <block type="play_sound"></block>
    </category>

    <category name="ğŸ˜Š Duygular" colour="#00B894">
      <block type="happy"></block>
      <block type="sad"></block>
      <block type="excited"></block>
      <block type="sleepy"></block>
      <block type="angry"></block>
    </category>

    <category name="ğŸ¾ Oyunlar" colour="#FDCB6E">
      <block type="fetch"></block>
      <block type="roll_over"></block>
      <block type="shake_hands"></block>
      <block type="dance"></block>
      <block type="chase_tail"></block>
    </category>

    <category name="â° Zaman" colour="#E17055">
      <block type="wait"></block>
      <block type="repeat_action"></block>
    </category>

    <category name="ğŸ¤” Karar Ver" colour="#A29BFE">
      <block type="if_happy"></block>
      <block type="if_tired"></block>
    </category>

    <category name="ğŸ”— BaÄŸlantÄ±" colour="#6C5CE7">
      <block type="ssh_connect"></block>
      <block type="ping_host"></block>
      <block type="check_port"></block>
    </category>

    <category name="ğŸ”¢ Matematik" colour="#FF7675">
      <block type="math_add"></block>
      <block type="math_subtract"></block>
      <block type="math_multiply"></block>
      <block type="math_number"></block>
      <block type="show_result"></block>
    </category>

    <category name="ğŸ” KarÅŸÄ±laÅŸtÄ±rma" colour="#00CEC9">
      <block type="math_compare"></block>
      <block type="logic_and"></block>
      <block type="logic_or"></block>
      <block type="logic_not"></block>
      <block type="logic_boolean"></block>
    </category>
  </xml>

  <script>
    let robotState = {
      position: 'standing',
      mood: 'happy',
      energy: 100,
      isMoving: false,
      isAwake: true,
      sshConnections: []
    };

    // Robot ASCII sanatlarÄ±
    const robotAsciiArt = {
      default: `    /\\_/\\  
   ( o.o ) 
    > ^ <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      sit: `    /\\_/\\  
   ( o.o ) 
    > ^ <  
   /     \\ 
  (  ___  )
     | |   
     |_|   `,

      lie_down: `    /\\_/\\  
   ( -.- ) 
    > ^ <  
 ___________
(           )
 -----------`,

      happy: `    /\\_/\\  
   ( ^.^ ) 
    > â—¡ <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      excited: `    /\\_/\\  
   ( â˜….â˜… ) 
    > â—¡ <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      sad: `    /\\_/\\  
   ( ;.; ) 
    > v <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      angry: `    /\\_/\\  
   ( >.< ) 
    > âˆ© <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      sleepy: `    /\\_/\\  
   ( -.z ) 
    > ~ <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      wake_up: `    /\\_/\\  
   ( O.O ) 
    > ! <  
   /     \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      connected: `    /\\_/\\  
   ( @.@ ) 
    > â—¡ <  
   /  ğŸ“¡  \\ 
  (  ___  )
   |  |  | 
   |__|__|`,

      scanning: `    /\\_/\\  
   ( -.o ) 
    > ~ <  
   /  ğŸ“¡  \\ 
  (  ___  )
   |  |  | 
   |__|__|`
    };

    // Robot Hareket BloklarÄ±
    Blockly.Blocks['move_forward'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ• Ä°leri Git");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot ileri doÄŸru hareket eder");
      }
    };

    Blockly.Blocks['move_backward'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ”™ Geri Git");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot geri doÄŸru hareket eder");
      }
    };

    Blockly.Blocks['turn_left'] = {
      init: function () {
        this.appendDummyInput().appendField("â†©ï¸ Sola DÃ¶n");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot sola dÃ¶ner");
      }
    };

    Blockly.Blocks['turn_right'] = {
      init: function () {
        this.appendDummyInput().appendField("â†ªï¸ SaÄŸa DÃ¶n");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot saÄŸa dÃ¶ner");
      }
    };

    Blockly.Blocks['sit'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸª‘ Otur");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot oturur");
      }
    };

    Blockly.Blocks['stand'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ§ AyaÄŸa Kalk");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot ayaÄŸa kalkar");
      }
    };

    Blockly.Blocks['lie_down'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜´ Uzan");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot uzanÄ±r");
      }
    };

    // YENÄ°: Uyan bloÄŸu
    Blockly.Blocks['wake_up'] = {
      init: function () {
        this.appendDummyInput().appendField("â˜€ï¸ Uyan");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF6B6B');
        this.setTooltip("Robot uyanÄ±r ve enerjisi dolar");
      }
    };

    // YENÄ°: SSH BaÄŸlantÄ± BloÄŸu - GERÃ‡EK KONTROL
    Blockly.Blocks['ssh_connect'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("ğŸ”— SSH BaÄŸlan:")
          .appendField(new Blockly.FieldTextInput("192.168.1.100"), "SSH_ADDRESS");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#6C5CE7');
        this.setTooltip("Belirtilen SSH adresine gerÃ§ek baÄŸlantÄ± kontrolÃ¼ yapar");
      }
    };

    // YENÄ°: Ping BloÄŸu - GERÃ‡EK PING
    Blockly.Blocks['ping_host'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("ğŸ“ Ping At:")
          .appendField(new Blockly.FieldTextInput("8.8.8.8"), "PING_ADDRESS");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#6C5CE7');
        this.setTooltip("Belirtilen adrese gerÃ§ek ping atar");
      }
    };

    // YENÄ°: Port Kontrol BloÄŸu - GERÃ‡EK PORT KONTROLÃœ
    Blockly.Blocks['check_port'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("ğŸ” Port Kontrol:")
          .appendField(new Blockly.FieldTextInput("google.com"), "HOST")
          .appendField("Port:")
          .appendField(new Blockly.FieldNumber(80, 1, 65535), "PORT");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#6C5CE7');
        this.setTooltip("Belirtilen host ve portu gerÃ§ek kontrol eder");
      }
    };

    // Ses BloklarÄ±
    Blockly.Blocks['bark'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ• Havla");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#74B9FF');
        this.setTooltip("Robot havlar");
      }
    };

    Blockly.Blocks['whine'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜¢ Ä°nle");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#74B9FF');
        this.setTooltip("Robot inler");
      }
    };

    Blockly.Blocks['howl'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸŒ™ Ulu");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#74B9FF');
        this.setTooltip("Robot ulur");
      }
    };

    Blockly.Blocks['play_sound'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("ğŸµ Ses Ã‡Ä±kar:")
          .appendField(new Blockly.FieldTextInput("Woof!"), "SOUND");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#74B9FF');
        this.setTooltip("Robot Ã¶zel ses Ã§Ä±karÄ±r");
      }
    };

    // Duygu BloklarÄ±
    Blockly.Blocks['happy'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜Š Mutlu Ol");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#00B894');
        this.setTooltip("Robot mutlu olur");
      }
    };

    Blockly.Blocks['sad'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜¢ ÃœzÃ¼l");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#00B894');
        this.setTooltip("Robot Ã¼zÃ¼lÃ¼r");
      }
    };

    Blockly.Blocks['excited'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ¤© Heyecanlan");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#00B894');
        this.setTooltip("Robot heyecanlanÄ±r");
      }
    };

    Blockly.Blocks['sleepy'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜´ Uykulu Ol");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#00B894');
        this.setTooltip("Robot uykulu olur");
      }
    };

    Blockly.Blocks['angry'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜  KÄ±zgÄ±n Ol");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#00B894');
        this.setTooltip("Robot kÄ±zgÄ±n olur");
      }
    };

    // Oyun BloklarÄ±
    Blockly.Blocks['fetch'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ¾ Top Getir");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FDCB6E');
        this.setTooltip("Robot top getirir");
      }
    };

    Blockly.Blocks['roll_over'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ”„ Takla At");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FDCB6E');
        this.setTooltip("Robot takla atar");
      }
    };

    Blockly.Blocks['shake_hands'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ¤ El SÄ±kÄ±ÅŸ");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FDCB6E');
        this.setTooltip("Robot el sÄ±kÄ±ÅŸÄ±r");
      }
    };

    Blockly.Blocks['dance'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ’ƒ Dans Et");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FDCB6E');
        this.setTooltip("Robot dans eder");
      }
    };

    Blockly.Blocks['chase_tail'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸŒ€ KuyruÄŸunu Kovala");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FDCB6E');
        this.setTooltip("Robot kuyruÄŸunu kovalar");
      }
    };

    // Zaman BloklarÄ±
    Blockly.Blocks['wait'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("â° Bekle")
          .appendField(new Blockly.FieldNumber(1, 1, 10), "SECONDS")
          .appendField("saniye");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#E17055');
        this.setTooltip("Robot belirtilen sÃ¼re bekler");
      }
    };

    Blockly.Blocks['repeat_action'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("ğŸ” Tekrarla")
          .appendField(new Blockly.FieldNumber(3, 1, 10), "TIMES")
          .appendField("kez:");
        this.appendStatementInput("DO").setCheck(null);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#E17055');
        this.setTooltip("Belirtilen iÅŸlemi tekrarlar");
      }
    };

    // Karar BloklarÄ±
    Blockly.Blocks['if_happy'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ¤” EÄŸer mutluysam:");
        this.appendStatementInput("DO").setCheck(null);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#A29BFE');
        this.setTooltip("Robot mutluysa iÅŸlem yapar");
      }
    };

    Blockly.Blocks['if_tired'] = {
      init: function () {
        this.appendDummyInput().appendField("ğŸ˜´ EÄŸer yorgunsam:");
        this.appendStatementInput("DO").setCheck(null);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#A29BFE');
        this.setTooltip("Robot yorgunsa iÅŸlem yapar");
      }
    };

    // Matematik BloklarÄ±
    Blockly.Blocks['math_add'] = {
      init: function () {
        this.appendValueInput("A")
          .setCheck("Number")
          .appendField("â•");
        this.appendValueInput("B")
          .setCheck("Number")
          .appendField("+");
        this.setOutput(true, "Number");
        this.setColour('#FF7675');
        this.setTooltip("Ä°ki sayÄ±yÄ± toplar");
      }
    };

    Blockly.Blocks['math_subtract'] = {
      init: function () {
        this.appendValueInput("A")
          .setCheck("Number")
          .appendField("â–");
        this.appendValueInput("B")
          .setCheck("Number")
          .appendField("-");
        this.setOutput(true, "Number");
        this.setColour('#FF7675');
        this.setTooltip("Ä°ki sayÄ±yÄ± Ã§Ä±karÄ±r");
      }
    };

    Blockly.Blocks['math_multiply'] = {
      init: function () {
        this.appendValueInput("A")
          .setCheck("Number")
          .appendField("âœ–ï¸");
        this.appendValueInput("B")
          .setCheck("Number")
          .appendField("Ã—");
        this.setOutput(true, "Number");
        this.setColour('#FF7675');
        this.setTooltip("Ä°ki sayÄ±yÄ± Ã§arpar");
      }
    };

    Blockly.Blocks['math_number'] = {
      init: function () {
        this.appendDummyInput()
          .appendField("ğŸ”¢")
          .appendField(new Blockly.FieldNumber(0), "NUM");
        this.setOutput(true, "Number");
        this.setColour('#FF7675');
        this.setTooltip("Bir sayÄ± deÄŸeri");
      }
    };

    Blockly.Blocks['show_result'] = {
      init: function () {
        this.appendValueInput("VALUE")
          .setCheck("Number")
          .appendField("ğŸ“Š Sonucu GÃ¶ster:");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour('#FF7675');
        this.setTooltip("Matematik iÅŸleminin sonucunu gÃ¶sterir");
      }
    };

    // KarÅŸÄ±laÅŸtÄ±rma BloklarÄ±
    Blockly.Blocks['math_compare'] = {
      init: function () {
        this.appendValueInput("A")
          .setCheck("Number");
        this.appendDummyInput()
          .appendField(new Blockly.FieldDropdown([
            ["ğŸŸ° eÅŸittir", "EQ"],
            ["â‰  eÅŸit deÄŸil", "NEQ"],
            ["< kÃ¼Ã§Ã¼ktÃ¼r", "LT"],
            ["â‰¤ kÃ¼Ã§Ã¼k eÅŸit", "LTE"],
            ["> bÃ¼yÃ¼ktÃ¼r", "GT"],
            ["â‰¥ bÃ¼yÃ¼k eÅŸit", "GTE"]
          ]), "OP");
        this.appendValueInput("B")
          .setCheck("Number");
        this.setOutput(true, "Boolean");
        this.setColour('#00CEC9');
        this.setTooltip("Ä°ki sayÄ±yÄ± karÅŸÄ±laÅŸtÄ±rÄ±r");
      }
    };

    // MantÄ±k VE BloÄŸu
    Blockly.Blocks['logic_and'] = {
      init: function () {
        this.appendValueInput("A")
          .setCheck("Boolean")
          .appendField("ğŸ”—");
        this.appendValueInput("B")
          .setCheck("Boolean")
          .appendField("VE");
        this.setOutput(true, "Boolean");
        this.setColour('#00CEC9');
        this.setTooltip("Her iki koÅŸul da doÄŸruysa doÄŸru dÃ¶ner");
      }
    };

    // MantÄ±k VEYA BloÄŸu
    Blockly.Blocks['logic_or'] = {
      init: function () {
        this.appendValueInput("A")
          .setCheck("Boolean")
          .appendField("ğŸ”€");
        this.appendValueInput("B")
          .setCheck("Boolean")
          .appendField("VEYA");
        this.setOutput(true, "Boolean");
        this.setColour('#00CEC9');
        this.setTooltip("KoÅŸullardan biri doÄŸruysa doÄŸru dÃ¶ner");
      }
    };

    // MantÄ±k DEÄÄ°L BloÄŸu
    Blockly.Blocks['logic_not'] = {
      init: function () {
        this.appendValueInput("BOOL")
          .setCheck("Boolean")
          .appendField("ğŸš« DEÄÄ°L");
        this.setOutput(true, "Boolean");
        this.setColour('#00CEC9');
        this.setTooltip("KoÅŸulun tersini dÃ¶ner");
      }
    };

    // Boolean DeÄŸer BloÄŸu
    Blockly.Blocks['logic_boolean'] = {
      init: function () {
        this.appendDummyInput()
          .appendField(new Blockly.FieldDropdown([
            ["âœ… doÄŸru", "TRUE"],
            ["âŒ yanlÄ±ÅŸ", "FALSE"]
          ]), "BOOL");
        this.setOutput(true, "Boolean");
        this.setColour('#00CEC9');
        this.setTooltip("DoÄŸru veya yanlÄ±ÅŸ deÄŸeri");
      }
    };
    // JavaScript Kod Ãœreticileri
    const javascriptGenerator = Blockly.JavaScript;

    // Hareket kod Ã¼reticileri
    javascriptGenerator.forBlock['move_forward'] = function (block) {

     // var code = `#!/usr/bin/env python3\nfrom pidog import Pidog \nfrom time import sleep\nmy_dog = Pidog()\nsleep(0.5)\nmy_dog.do_action('forward', speed=98)\nmy_dog.wait_all_done()\nmy_dog.close()

     
var code = `#!/usr/bin/env python3
from pidog import Pidog
from time import sleep

my_dog = Pidog()
sleep(0.5)

try:
    my_dog.do_action('forward', speed=98)
    my_dog.wait_all_done()
    sleep(0.5)
except KeyboardInterrupt:
    pass
except Exception as e:
    print(f"\\033[31mERROR: {e}\\033[m")
finally:
    my_dog.close()
`;
           
     
      return code;
    };

    javascriptGenerator.forBlock['move_backward'] = function (block) {

var code = `#!/usr/bin/env python3
from pidog import Pidog
from time import sleep

my_dog = Pidog()
sleep(0.5)

try:
    my_dog.do_action('backward', speed=98)
    my_dog.wait_all_done()
    sleep(0.5)
except KeyboardInterrupt:
    pass
except Exception as e:
    print(f"\\033[31mERROR: {e}\\033[m")
finally:
    my_dog.close()
`;
      
              
      return code;
    };

    javascriptGenerator.forBlock['turn_left'] = function (block) {
var code = `#!/usr/bin/env python3
from pidog import Pidog
from time import sleep

my_dog = Pidog()
sleep(0.5)

try:
    my_dog.do_action('turn_left', speed=98)
    my_dog.wait_all_done()
    sleep(0.5)
except KeyboardInterrupt:
    pass
except Exception as e:
    print(f"\\033[31mERROR: {e}\\033[m")
finally:
    my_dog.close()
`;

      return code;
    };

    javascriptGenerator.forBlock['turn_right'] = function (block) {

var code = `#!/usr/bin/env python3
from pidog import Pidog
from time import sleep

my_dog = Pidog()
sleep(0.5)

try:
    my_dog.do_action('turn_right', speed=98)
    my_dog.wait_all_done()
    sleep(0.5)
except KeyboardInterrupt:
    pass
except Exception as e:
    print(f"\\033[31mERROR: {e}\\033[m")
finally:
    my_dog.close()
`;

      return code;
    };

    javascriptGenerator.forBlock['sit'] = function (block) {

var code = `#!/usr/bin/env python3
from pidog import Pidog
from time import sleep

my_dog = Pidog()
sleep(0.5)

try:
    my_dog.do_action('sit', speed=70)
    my_dog.wait_all_done()
    sleep(0.5)
except KeyboardInterrupt:
    pass
except Exception as e:
    print(f"\\033[31mERROR: {e}\\033[m")
finally:
    my_dog.close()
`;

      return code;
    };

    javascriptGenerator.forBlock['stand'] = function (block) {
var code = `#!/usr/bin/env python3
from pidog import Pidog
import time

# Pidog'u baÅŸlat
my_dog = Pidog()
time.sleep(0.5)

# Ayakta durma (stand) hareketini yap
my_dog.do_action('stand', speed=70)
my_dog.wait_all_done()

# KaynaklarÄ± serbest bÄ±rak
my_dog.close()
`;

      return 'robotAction("stand", "ğŸ§ AyaÄŸa kalkÄ±yorum!");\n';
    };

    javascriptGenerator.forBlock['lie_down'] = function (block) {
var code = `#!/usr/bin/env python3
from pidog import Pidog
import time

# Pidog'u baÅŸlat
my_dog = Pidog()
time.sleep(0.5)

# Uzanma (lie) hareketini yap
my_dog.do_action('lie', speed=70)
my_dog.wait_all_done()

# KaynaklarÄ± serbest bÄ±rak
my_dog.close()
`;      
      return code;
    };

    // YENÄ°: Uyan kod Ã¼reticisi
    javascriptGenerator.forBlock['wake_up'] = function (block) {
var code = `#!/usr/bin/env python3
from pidog import Pidog
from time import sleep
from preset_actions import pant
from preset_actions import body_twisting

my_dog = Pidog(head_init_angles=[0, 0, -30])
sleep(1)

try:
    # stretch
    my_dog.rgb_strip.set_mode('listen', color='yellow', bps=0.6, brightness=0.8)
    my_dog.do_action('stretch', speed=50)
    my_dog.head_move([[0, 0, 30]]*2, immediately=True)
    my_dog.wait_all_done()
    sleep(0.2)

    body_twisting(my_dog)
    my_dog.wait_all_done()
    sleep(0.5)
    my_dog.head_move([[0, 0, -30]], immediately=True, speed=90)

    # sit and wag_tail
    my_dog.do_action('sit', speed=25)
    my_dog.wait_legs_done()
    my_dog.do_action('wag_tail', step_count=10, speed=100)
    my_dog.rgb_strip.set_mode('breath', color=[245, 10, 10], bps=2.5, brightness=0.8)
    pant(my_dog, pitch_comp=-30, volume=80)
    my_dog.wait_all_done()

    # hold
    my_dog.do_action('wag_tail', step_count=10, speed=30)
    my_dog.rgb_strip.set_mode('breath', 'pink', bps=0.5)
    while True:
        sleep(1)

except KeyboardInterrupt:
    pass
except Exception as e:
    print(f"\\033[31mERROR: {e}\\033[m")
finally:
    my_dog.close()
`;
      

      return code;
    };

    // YENÄ°: GERÃ‡EK SSH BaÄŸlantÄ± kod Ã¼reticisi
    javascriptGenerator.forBlock['ssh_connect'] = function (block) {
      var sshAddress = block.getFieldValue('SSH_ADDRESS');
      return 'realSshConnect("' + sshAddress + '");\n';
    };

    // YENÄ°: GERÃ‡EK Ping kod Ã¼reticisi
    javascriptGenerator.forBlock['ping_host'] = function (block) {
      var pingAddress = block.getFieldValue('PING_ADDRESS');
      return 'realPingHost("' + pingAddress + '");\n';
    };

    // YENÄ°: GERÃ‡EK Port kontrol kod Ã¼reticisi
    javascriptGenerator.forBlock['check_port'] = function (block) {
      var host = block.getFieldValue('HOST');
      var port = block.getFieldValue('PORT');
      return 'realCheckPort("' + host + '", ' + port + ');\n';
    };

    // Ses kod Ã¼reticileri
    javascriptGenerator.forBlock['bark'] = function (block) {
      return 'robotAction("bark", "ğŸ• HAV HAV HAV!");\n';
    };

    javascriptGenerator.forBlock['whine'] = function (block) {
      return 'robotAction("whine", "ğŸ˜¢ Ä°nnn... Ä°nnn...");\n';
    };

    javascriptGenerator.forBlock['howl'] = function (block) {
      return 'robotAction("howl", "ğŸŒ™ AUUUUUU!");\n';
    };

    javascriptGenerator.forBlock['play_sound'] = function (block) {
      var sound = block.getFieldValue('SOUND');
      return 'robotAction("play_sound", "ğŸµ ' + sound + '");\n';
    };

    // Duygu kod Ã¼reticileri
    javascriptGenerator.forBlock['happy'] = function (block) {
      return 'robotAction("happy", "ğŸ˜Š Ã‡ok mutluyum! KuyruÄŸumu sallÄ±yorum!");\n';
    };

    javascriptGenerator.forBlock['sad'] = function (block) {
      return 'robotAction("sad", "ğŸ˜¢ ÃœzgÃ¼nÃ¼m... KafamÄ± eÄŸiyorum...");\n';
    };

    javascriptGenerator.forBlock['excited'] = function (block) {
      return 'robotAction("excited", "ğŸ¤© Ã‡ok heyecanlÄ±yÄ±m! ZÄ±plÄ±yorum!");\n';
    };

    javascriptGenerator.forBlock['sleepy'] = function (block) {
      return 'robotAction("sleepy", "ğŸ˜´ Ã‡ok uykulum... Esniyorum...");\n';
    };

    javascriptGenerator.forBlock['angry'] = function (block) {
      return 'robotAction("angry", "ğŸ˜  KÄ±zgÄ±nÄ±m! HÄ±rr!");\n';
    };

    // Oyun kod Ã¼reticileri
    javascriptGenerator.forBlock['fetch'] = function (block) {
      return 'robotAction("fetch", "ğŸ¾ Topu getiriyorum! KoÅŸuyorum!");\n';
    };

    javascriptGenerator.forBlock['roll_over'] = function (block) {
      return 'robotAction("roll_over", "ğŸ”„ Takla atÄ±yorum! Wheee!");\n';
    };

    javascriptGenerator.forBlock['shake_hands'] = function (block) {
      return 'robotAction("shake_hands", "ğŸ¤ Pati veriyorum!");\n';
    };

    javascriptGenerator.forBlock['dance'] = function (block) {
      return 'robotAction("dance", "ğŸ’ƒ Dans ediyorum! MÃ¼zik aÃ§Ä±n!");\n';
    };

    javascriptGenerator.forBlock['chase_tail'] = function (block) {
      return 'robotAction("chase_tail", "ğŸŒ€ KuyruÄŸumu yakalayacaÄŸÄ±m!");\n';
    };

    // Zaman kod Ã¼reticileri
    javascriptGenerator.forBlock['wait'] = function (block) {
      var seconds = block.getFieldValue('SECONDS');
      
      
      return 'sleep(' + seconds + ');\n';
    };

    javascriptGenerator.forBlock['repeat_action'] = function (block) {
      var times = block.getFieldValue('TIMES');
      var statements = javascriptGenerator.statementToCode(block, 'DO');
      
      return 'for i in range(' + times + '):\n' + statements + '\n';
         
    };

    // Karar kod Ã¼reticileri
    javascriptGenerator.forBlock['if_happy'] = function (block) {
      var statements = javascriptGenerator.statementToCode(block, 'DO');
      return 'if(robotState.mood === "happy") {\n' + statements + '}\n';
    };

    javascriptGenerator.forBlock['if_tired'] = function (block) {
      var statements = javascriptGenerator.statementToCode(block, 'DO');
      return 'if(robotState.energy < 30) {\n' + statements + '}\n';
    };

    // Matematik kod Ã¼reticileri
    javascriptGenerator.forBlock['math_add'] = function (block) {
      var valueA = javascriptGenerator.valueToCode(block, 'A', javascriptGenerator.ORDER_ADDITION) || '0';
      var valueB = javascriptGenerator.valueToCode(block, 'B', javascriptGenerator.ORDER_ADDITION) || '0';
      var code = '(' + valueA + ' + ' + valueB + ')';
      return [code, javascriptGenerator.ORDER_ADDITION];
    };

    javascriptGenerator.forBlock['math_subtract'] = function (block) {
      var valueA = javascriptGenerator.valueToCode(block, 'A', javascriptGenerator.ORDER_SUBTRACTION) || '0';
      var valueB = javascriptGenerator.valueToCode(block, 'B', javascriptGenerator.ORDER_SUBTRACTION) || '0';
      var code = '(' + valueA + ' - ' + valueB + ')';
      return [code, javascriptGenerator.ORDER_SUBTRACTION];
    };

    javascriptGenerator.forBlock['math_multiply'] = function (block) {
      var valueA = javascriptGenerator.valueToCode(block, 'A', javascriptGenerator.ORDER_MULTIPLICATION) || '0';
      var valueB = javascriptGenerator.valueToCode(block, 'B', javascriptGenerator.ORDER_MULTIPLICATION) || '0';
      var code = '(' + valueA + ' * ' + valueB + ')';
      return [code, javascriptGenerator.ORDER_MULTIPLICATION];
    };

    javascriptGenerator.forBlock['math_number'] = function (block) {
      var code = parseFloat(block.getFieldValue('NUM'));
      return [code, javascriptGenerator.ORDER_ATOMIC];
    };

    javascriptGenerator.forBlock['show_result'] = function (block) {
      var value = javascriptGenerator.valueToCode(block, 'VALUE', javascriptGenerator.ORDER_ATOMIC) || '0';
      return 'showMathResult(' + value + ');\n';
    };

    // KarÅŸÄ±laÅŸtÄ±rma kod Ã¼reticileri
    javascriptGenerator.forBlock['math_compare'] = function (block) {
      var valueA = javascriptGenerator.valueToCode(block, 'A', javascriptGenerator.ORDER_RELATIONAL) || '0';
      var valueB = javascriptGenerator.valueToCode(block, 'B', javascriptGenerator.ORDER_RELATIONAL) || '0';
      var operator = block.getFieldValue('OP');

      var operatorMap = {
        'EQ': '==',
        'NEQ': '!=',
        'LT': '<',
        'LTE': '<=',
        'GT': '>',
        'GTE': '>='
      };

      var code = '(' + valueA + ' ' + operatorMap[operator] + ' ' + valueB + ')';
      return [code, javascriptGenerator.ORDER_RELATIONAL];
    };

    javascriptGenerator.forBlock['logic_and'] = function (block) {
      var valueA = javascriptGenerator.valueToCode(block, 'A', javascriptGenerator.ORDER_LOGICAL_AND) || 'false';
      var valueB = javascriptGenerator.valueToCode(block, 'B', javascriptGenerator.ORDER_LOGICAL_AND) || 'false';
      var code = '(' + valueA + ' && ' + valueB + ')';
      return [code, javascriptGenerator.ORDER_LOGICAL_AND];
    };

    javascriptGenerator.forBlock['logic_or'] = function (block) {
      var valueA = javascriptGenerator.valueToCode(block, 'A', javascriptGenerator.ORDER_LOGICAL_OR) || 'false';
      var valueB = javascriptGenerator.valueToCode(block, 'B', javascriptGenerator.ORDER_LOGICAL_OR) || 'false';
      var code = '(' + valueA + ' || ' + valueB + ')';
      return [code, javascriptGenerator.ORDER_LOGICAL_OR];
    };

    javascriptGenerator.forBlock['logic_not'] = function (block) {
      var value = javascriptGenerator.valueToCode(block, 'BOOL', javascriptGenerator.ORDER_LOGICAL_NOT) || 'false';
      var code = '!' + value;
      return [code, javascriptGenerator.ORDER_LOGICAL_NOT];
    };

    javascriptGenerator.forBlock['logic_boolean'] = function (block) {
      var code = (block.getFieldValue('BOOL') === 'TRUE') ? 'true' : 'false';
      return [code, javascriptGenerator.ORDER_ATOMIC];
    };
    // Workspace oluÅŸtur
    var workspace = Blockly.inject('blocklyDiv', {
      toolbox: document.getElementById('toolbox'),
      trashcan: true,
      scrollbars: true,
      grid: {
        spacing: 25,
        length: 3,
        colour: '#ccc',
        snap: true
      },
      zoom: {
        controls: true,
        wheel: true,
        startScale: 0.7,
        maxScale: 2,
        minScale: 0.3,
        scaleSpeed: 1.2
      }
    });

    // Robot fonksiyonlarÄ±
    function robotAction(action, message) {
      addToOutput(message);
      updateRobotDisplay(action);
      updateRobotState(action);
    }

    function robotWait(seconds) {
      addToOutput(`â° ${seconds} saniye bekliyorum...`);
      // GerÃ§ek bekleme simÃ¼lasyonu iÃ§in setTimeout kullanabiliriz
    }

    // YENÄ°: GERÃ‡EK SSH BaÄŸlantÄ± fonksiyonu
    async function realSshConnect(address) {
      addToOutput(`ğŸ”— SSH baÄŸlantÄ±sÄ± kontrol ediliyor: ${address}:22`);
      robotAction("scanning", `ğŸ” ${address} adresini tarÄ±yorum...`);

      try {
        // GerÃ§ek ping testi ile SSH portunu kontrol et
        const isReachable = await checkHostReachability(address);
        const isPortOpen = await checkPortOpen(address, 22);

        if (isReachable && isPortOpen) {
          robotState.sshConnections.push(address);
          addToOutput(`âœ… SSH portu aÃ§Ä±k: ${address}:22`);
          addToOutput(`ğŸ” SSH servisi Ã§alÄ±ÅŸÄ±yor!`);
          robotAction("connected", `ğŸ”— ${address} SSH baÄŸlantÄ±sÄ± mÃ¼mkÃ¼n!`);
        } else if (isReachable && !isPortOpen) {
          addToOutput(`âš ï¸ Host eriÅŸilebilir ama SSH portu kapalÄ±: ${address}:22`);
          addToOutput(`ğŸš« SSH servisi Ã§alÄ±ÅŸmÄ±yor!`);
          robotAction("sad", "ğŸ˜¢ SSH portu kapalÄ±...");
        } else {
          addToOutput(`âŒ Host eriÅŸilemiyor: ${address}`);
          addToOutput(`ğŸŒ AÄŸ baÄŸlantÄ±sÄ± yok veya host mevcut deÄŸil!`);
          robotAction("sad", "ğŸ˜¢ BaÄŸlantÄ± kuramadÄ±m...");
        }
      } catch (error) {
        addToOutput(`âŒ BaÄŸlantÄ± hatasÄ±: ${error.message}`);
        robotAction("sad", "ğŸ˜¢ Bir hata oluÅŸtu...");
      }
    }

    // YENÄ°: GERÃ‡EK Ping fonksiyonu
    async function realPingHost(address) {
      addToOutput(`ğŸ“ Ping atÄ±lÄ±yor: ${address}`);
      robotAction("scanning", `ğŸ” ${address} adresini ping'liyorum...`);

      try {
        const isReachable = await checkHostReachability(address);

        if (isReachable) {
          addToOutput(`âœ… Ping baÅŸarÄ±lÄ±: ${address}`);
          addToOutput(`ğŸŒ Host eriÅŸilebilir!`);
          robotAction("happy", `ğŸ“ ${address} ping'e cevap veriyor!`);
        } else {
          addToOutput(`âŒ Ping baÅŸarÄ±sÄ±z: ${address}`);
          addToOutput(`ğŸš« Host eriÅŸilemiyor!`);
          robotAction("sad", "ğŸ˜¢ Ping cevap alamadÄ±m...");
        }
      } catch (error) {
        addToOutput(`âŒ Ping hatasÄ±: ${error.message}`);
        robotAction("sad", "ğŸ˜¢ Ping atarken hata oluÅŸtu...");
      }
    }

    // YENÄ°: GERÃ‡EK Port kontrol fonksiyonu
    async function realCheckPort(host, port) {
      addToOutput(`ğŸ” Port kontrol ediliyor: ${host}:${port}`);
      robotAction("scanning", `ğŸ” ${host}:${port} portunu kontrol ediyorum...`);

      try {
        const isPortOpen = await checkPortOpen(host, port);

        if (isPortOpen) {
          addToOutput(`âœ… Port aÃ§Ä±k: ${host}:${port}`);
          addToOutput(`ğŸ”“ Servis Ã§alÄ±ÅŸÄ±yor!`);
          robotAction("happy", `ğŸ” ${host}:${port} portu aÃ§Ä±k!`);
        } else {
          addToOutput(`âŒ Port kapalÄ±: ${host}:${port}`);
          addToOutput(`ğŸ”’ Servis Ã§alÄ±ÅŸmÄ±yor veya eriÅŸilemiyor!`);
          robotAction("sad", "ğŸ˜¢ Port kapalÄ±...");
        }
      } catch (error) {
        addToOutput(`âŒ Port kontrol hatasÄ±: ${error.message}`);
        robotAction("sad", "ğŸ˜¢ Port kontrol edilemedi...");
      }
    }

    // GERÃ‡EK host eriÅŸilebilirlik kontrolÃ¼
    async function checkHostReachability(host) {
      try {
        // Fetch ile HTTP/HTTPS kontrolÃ¼
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 saniye timeout

        // Ã–nce HTTPS dene
        try {
          const response = await fetch(`https://${host}`, {
            method: 'HEAD',
            mode: 'no-cors',
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          return true;
        } catch (httpsError) {
          // HTTPS baÅŸarÄ±sÄ±zsa HTTP dene
          try {
            const response = await fetch(`http://${host}`, {
              method: 'HEAD',
              mode: 'no-cors',
              signal: controller.signal
            });
            clearTimeout(timeoutId);
            return true;
          } catch (httpError) {
            clearTimeout(timeoutId);
            return false;
          }
        }
      } catch (error) {
        return false;
      }
    }

    // GERÃ‡EK port aÃ§Ä±klÄ±k kontrolÃ¼
    async function checkPortOpen(host, port) {
      try {
        // WebSocket ile port kontrolÃ¼
        return new Promise((resolve) => {
          const timeout = setTimeout(() => {
            resolve(false);
          }, 5000);

          // YaygÄ±n portlar iÃ§in Ã¶zel kontroller
          if (port === 80) {
            fetch(`http://${host}`, { method: 'HEAD', mode: 'no-cors' })
              .then(() => {
                clearTimeout(timeout);
                resolve(true);
              })
              .catch(() => {
                clearTimeout(timeout);
                resolve(false);
              });
          } else if (port === 443) {
            fetch(`https://${host}`, { method: 'HEAD', mode: 'no-cors' })
              .then(() => {
                clearTimeout(timeout);
                resolve(true);
              })
              .catch(() => {
                clearTimeout(timeout);
                resolve(false);
              });
          } else {
            // DiÄŸer portlar iÃ§in WebSocket denemesi
            try {
              const ws = new WebSocket(`ws://${host}:${port}`);
              ws.onopen = () => {
                clearTimeout(timeout);
                ws.close();
                resolve(true);
              };
              ws.onerror = () => {
                clearTimeout(timeout);
                resolve(false);
              };
            } catch (error) {
              clearTimeout(timeout);
              resolve(false);
            }
          }
        });
      } catch (error) {
        return false;
      }
    }

    // Matematik sonucu gÃ¶sterme fonksiyonu
    function showMathResult(result) {
      addToOutput(`ğŸ“Š Matematik Sonucu: ${result}`);
      robotAction("happy", `ğŸ”¢ HesapladÄ±m! SonuÃ§: ${result}`);
    }

    function addToOutput(message) {
      const output = document.getElementById('output');
      output.innerHTML += '<br>ğŸ¾ ' + message;
      output.scrollTop = output.scrollHeight;
    }

    function updateRobotDisplay(action) {
      const display = document.getElementById('robotDisplay');
      const status = document.getElementById('robotStatus');

      // Robot ASCII sanatÄ±nÄ± gÃ¼ncelle
      let robotArt = robotAsciiArt[action] || robotAsciiArt.default;

      switch (action) {
        case 'sit':
          status.textContent = 'ğŸª‘ Oturuyorum!';
          break;
        case 'lie_down':
          status.textContent = 'ğŸ˜´ UzanÄ±yorum!';
          break;
        case 'wake_up':
          status.textContent = 'â˜€ï¸ UyanÄ±yorum!';
          display.classList.add('shaking');
          setTimeout(() => display.classList.remove('shaking'), 1500);
          break;
        case 'connected':
          status.textContent = 'ğŸ”— BaÄŸlantÄ± Kuruldu!';
          display.classList.add('bouncing');
          setTimeout(() => display.classList.remove('bouncing'), 3000);
          break;
        case 'scanning':
          status.textContent = 'ğŸ” Tarama YapÄ±yorum!';
          display.classList.add('wagging');
          setTimeout(() => display.classList.remove('wagging'), 2000);
          break;
        case 'happy':
          status.textContent = 'ğŸ˜Š Ã‡ok Mutluyum!';
          display.classList.add('wagging');
          setTimeout(() => display.classList.remove('wagging'), 2000);
          break;
        case 'excited':
          status.textContent = 'ğŸ¤© Ã‡ok HeyecanlÄ±yÄ±m!';
          display.classList.add('bouncing');
          setTimeout(() => display.classList.remove('bouncing'), 3000);
          break;
        case 'sad':
          status.textContent = 'ğŸ˜¢ ÃœzgÃ¼nÃ¼m...';
          break;
        case 'angry':
          status.textContent = 'ğŸ˜  KÄ±zgÄ±nÄ±m!';
          break;
        case 'sleepy':
          status.textContent = 'ğŸ˜´ Ã‡ok Uykulum...';
          break;
        default:
          status.textContent = 'ğŸ• ' + getActionText(action);
      }

      display.innerHTML = robotArt;
    }

    function getActionText(action) {
      const actions = {
        'move_forward': 'Ä°leri Gidiyorum!',
        'move_backward': 'Geri Gidiyorum!',
        'turn_left': 'Sola DÃ¶nÃ¼yorum!',
        'turn_right': 'SaÄŸa DÃ¶nÃ¼yorum!',
        'bark': 'HavlÄ±yorum!',
        'fetch': 'Top Getiriyorum!',
        'dance': 'Dans Ediyorum!',
        'roll_over': 'Takla AtÄ±yorum!',
        'wake_up': 'UyanÄ±yorum!',
        'connected': 'BaÄŸlantÄ± Kurdum!',
        'scanning': 'Tarama YapÄ±yorum!'
      };
      return actions[action] || 'HazÄ±rÄ±m!';
    }

    function updateRobotState(action) {
      switch (action) {
        case 'sit':
        case 'lie_down':
          robotState.position = action;
          robotState.energy += 10;
          break;
        case 'wake_up':
          robotState.isAwake = true;
          robotState.energy = 100; // Enerji tam dolar
          robotState.mood = 'happy';
          robotState.position = 'standing';
          break;
        case 'connected':
        case 'scanning':
          robotState.mood = 'excited';
          robotState.energy += 5;
          break;
        case 'move_forward':
        case 'move_backward':
        case 'turn_left':
        case 'turn_right':
          robotState.energy -= 5;
          break;
        case 'happy':
        case 'excited':
          robotState.mood = 'happy';
          break;
        case 'sad':
          robotState.mood = 'sad';
          break;
        case 'sleepy':
          robotState.isAwake = false;
          robotState.energy -= 20;
          break;
        case 'dance':
        case 'fetch':
          robotState.energy -= 15;
          robotState.mood = 'happy';
          break;
      }

      // Enerji sÄ±nÄ±rlarÄ±
      robotState.energy = Math.max(0, Math.min(100, robotState.energy));
    }

    function runCode() {
      const output = document.getElementById('output');
      output.innerHTML = '<strong>ğŸ® Robot Konsolu:</strong><br>ğŸš€ Kodu Ã§alÄ±ÅŸtÄ±rÄ±yorum...';

      var code = Blockly.JavaScript.workspaceToCode(workspace);
      console.log("Ãœretilen Kod:", code);

      try {
        // Blockly Ã§alÄ±ÅŸma alanÄ±ndaki kodu al
        const code = Blockly.JavaScript.workspaceToCode(workspace);

        console.log(code);
        // JSON veri formatÄ±
        const jsonData = {
          code: code,
          timestamp: new Date().toISOString(),
          user: "test_kullanici"
        };

        console.log("GÃ¶nderilen JSON:", JSON.stringify(jsonData, null, 2));

        let command = {
          code: ""
        }


        fetch('http://192.168.4.1:5280/execute', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            code: code,
            timestamp: "2025-07-22T00:00:00.000Z",
            user: "test_kullanici"
          })
        })
          .then(res => res.text())
          .then(console.log)
          .catch(console.error);

          

      } catch (e) {
        alert("Kod Ã§alÄ±ÅŸtÄ±rma hatasÄ±: " + e);
      }
    }

    function resetRobot() {
      robotState = {
        position: 'standing',
        mood: 'happy',
        energy: 100,
        isMoving: false,
        isAwake: true,
        sshConnections: []
      };

      const output = document.getElementById('output');
      output.innerHTML = '<strong>ğŸ® Robot Konsolu:</strong><br>ğŸ”„ Robot sÄ±fÄ±rlandÄ±! Yeni maceraya hazÄ±rÄ±m! ğŸ¾';

      const display = document.getElementById('robotDisplay');
      const status = document.getElementById('robotStatus');

      display.innerHTML = robotAsciiArt.default;
      status.textContent = 'ğŸ• Robot HazÄ±r!';
      display.classList.remove('wagging', 'bouncing', 'shaking');
    }

    // Sayfa yÃ¼klendiÄŸinde robot gÃ¶rselini ayarla
    window.addEventListener('load', function () {
      // Robot gÃ¶rselini baÅŸlat
      document.getElementById('robotDisplay').innerHTML = robotAsciiArt.default;

      // BaÅŸlangÄ±Ã§ bloklarÄ± ekle
      const startBlocks = `
    <xml xmlns="https://developers.google.com/blockly/xml">
      <block type="if_happy" x="50" y="50">
        <statement name="DO">
          <block type="show_result">
            <value name="VALUE">
              <block type="math_add">
                <value name="A">
                  <block type="math_number">
                    <field name="NUM">10</field>
                  </block>
                </value>
                <value name="B">
                  <block type="math_number">
                    <field name="NUM">5</field>
                  </block>
                </value>
              </block>
            </value>
            <next>
              <block type="bark"></block>
            </next>
          </block>
        </statement>
        <next>
          <block type="repeat_action">
            <field name="TIMES">2</field>
            <statement name="DO">
              <block type="dance">
                <next>
                  <block type="wait">
                    <field name="SECONDS">1</field>
                  </block>
                </next>
              </block>
            </statement>
            <next>
              <block type="sit"></block>
            </next>
          </block>
        </next>
      </block>
      
      <block type="math_compare" x="400" y="50">
        <value name="A">
          <block type="math_number">
            <field name="NUM">15</field>
          </block>
        </value>
        <field name="OP">GT</field>
        <value name="B">
          <block type="math_number">
            <field name="NUM">10</field>
          </block>
        </value>
      </block>
      
      <block type="logic_and" x="400" y="150">
        <value name="A">
          <block type="logic_boolean">
            <field name="BOOL">TRUE</field>
          </block>
        </value>
        <value name="B">
          <block type="math_compare">
            <value name="A">
              <block type="math_number">
                <field name="NUM">5</field>
              </block>
            </value>
            <field name="OP">LT</field>
            <value name="B">
              <block type="math_number">
                <field name="NUM">10</field>
              </block>
            </value>
          </block>
        </value>
      </block>
    </xml>`;

     // Blockly.Xml.domToWorkspace(Blockly.utils.xml.textToDom(startBlocks), workspace);
    });
  </script>

</body>

</html>